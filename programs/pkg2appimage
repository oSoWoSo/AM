#!/bin/sh

mkdir /opt/pkg2appimage
cd /opt/pkg2appimage
mkdir tmp
cd tmp
wget -r -A .AppImage -nd https://github.com/AppImage/pkg2appimage/releases/tag/continuous
cd ..
mv ./tmp/*AppImage ./pkg2appimage
rmdir ./tmp
chmod a+x ./pkg2appimage
ln -s /opt/pkg2appimage/pkg2appimage /usr/bin/pkg2appimage

# Creating a script that removes all the files listed above
rm /opt/eya/remove/pkg2appimage
echo '#!/bin/sh
rm -R /usr/bin/pkg2appimage /opt/pkg2appimage/pkg2appimage /opt/pkg2appimage/about-pkg2appimage /opt/pkg2appimage/remove-pkg2appimage /opt/eya/programs/pkg2appimage' >> /opt/pkg2appimage/remove-pkg2appimage
chmod a+x /opt/pkg2appimage/remove-pkg2appimage

# Creating an about file
rm /opt/pkg2appimage/about-pkg2appimage
echo "
 Utility to convert .yml recipes to AppDir
 
 SITE: https://github.com/AppImage/pkg2appimage" >> /opt/pkg2appimage/about-pkg2appimage

# Changing privileges in /opt/pkg2appimage to allow automatic updates
currentuser=$(who | awk '{print $1}')
chown -R $currentuser /opt/pkg2appimage

# Message
echo ""
echo " pkg2appimage has been installed!"
echo ""
