#!/bin/sh

# Creating a dedicated folder for wine-devel
mkdir /opt/wine-devel
cd /opt/wine-devel

# Creating a script that removes all the files listed
rm -R -f /opt/wine-devel/remove
echo '#!/bin/sh
rm -R -f /usr/bin/wine /usr/bin/wineserver /opt/wine-devel' >> /opt/wine-devel/remove
chmod a+x /opt/wine-devel/remove

mkdir tmp
cd ./tmp

# Downloading the AppImage
wget -r -A .AppImage -nd https://github.com/mmtrt/WINE_AppImage/releases/tag/continuous-devel
cd ..
mv ./tmp/wine*AppImage ./wine-devel
chmod a+x ./wine-devel
rmdir ./tmp

ln -s /opt/wine-devel/wine-devel /usr/bin/wineserver

echo '#!/bin/sh
cd /opt/wine-devel
appimageupdate -O wine-devel
rm *zs-old
case "$1" in' >> /usr/bin/wine
echo "  'wine') exec /opt/wine-devel/wine-devel ;;" >> /usr/bin/wine
echo '  *) exec /opt/wine-devel/wine-devel "$@" ;;
esac' >> /usr/bin/wine
chmod a+x /usr/bin/wine

# Creating the "about" file
rm -R -f /opt/wine-devel/about
echo "
 WINE - Compatibility layer to run MS Windows apps and games on GNU/Linux.
 
 This version is for both x86 and x64 MS Windows programs.
 
 USAGE: wine winecfg (this will launch WINE Config)
        wine <program>.exe (to launch a Windows program)
 
 SITE: https://www.winehq.org
 SOURCE: https://github.com/mmtrt/WINE_AppImage" >> /opt/wine-devel/about
 
# Changing privileges in /opt/wine-devel to allow automatic updates
currentuser=$(who | awk '{print $1}')
chown -R $currentuser /opt/wine-devel

echo "
 WINE - Compatibility layer to run MS Windows apps and games on GNU/Linux.
 
 This version is for both x86 and x64 MS Windows programs.
 
 USAGE: wine winecfg (this will launch WINE Config)
        wine <program>.exe (to launch a Windows program)
 
 SITE: https://www.winehq.org
 
 SOURCE: https://github.com/mmtrt/WINE_AppImage
 "
